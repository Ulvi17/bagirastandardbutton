<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bagira AI - Интеллектуальный ассистент для юридических фирм</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #7A3FFD;
      --primary-darker: #6028d1;
      --secondary-color: #22A39F;
      --text-color-dark: #2c3e50;
      --text-color-light: #5a6a7a;
      --bg-light: #f8f9fa;
      --bg-white: #ffffff;
      --border-color: #e0e0e0;
      --success-color: #28a745;
      --error-color: #dc3545;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      margin: 0;
      background-color: var(--bg-light);
      color: var(--text-color-dark);
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container {
      width: 90%;
      max-width: 1024px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      font-weight: 600;
      font-size: 1rem;
      text-decoration: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, transform 0.1s ease, box-shadow 0.2s ease;
      text-align: center;
      border: none;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn-primary:hover {
      background-color: var(--primary-darker);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    header.page-header {
      background-color: var(--bg-white);
      padding: 20px 0;
      border-bottom: 1px solid var(--border-color);
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 999;
    }
    header.page-header .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 5px;
    }
    header.page-header .logo-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-right: 10px;
        line-height: 1;
    }
    header.page-header h1.site-title {
      color: var(--text-color-dark);
      font-size: 2.2rem;
      margin: 0;
      font-weight: 700;
    }
    header.page-header .tagline {
      color: var(--text-color-light);
      font-size: 1rem;
      font-weight: 400;
      margin: 0;
    }

    .hero-section {
        background-color: var(--bg-white);
        color: var(--text-color-dark);
        padding: 70px 0 60px 0;
        text-align: center;
    }
    .hero-section .container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .hero-section .main-page-heading {
        color: var(--text-color-dark);
        font-size: 2.8rem;
        font-weight: 700;
        margin-bottom: 20px;
        max-width: 850px;
        line-height: 1.2;
    }
    .hero-section .main-page-subheading {
        color: var(--text-color-light);
        font-size: 1.25rem;
        margin-bottom: 35px;
        max-width: 750px;
    }
    .hero-section #joinPilotBtnHero {
        margin-bottom: 40px;
    }

    .video-responsive-wrapper {
        position: relative;
        overflow: hidden;
        width: 100%;
        max-width: 720px; 
        padding-top: 56.25%; 
        margin: 0 auto 40px auto; 
        border-radius: 8px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
    }
    .video-responsive-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
        border: none; 
    }

    main {
      flex-grow: 1;
      padding-top: 0; 
    }
    section {
      padding: 40px 0; /* Default padding for sections */
      text-align: center;
    }
    main > section:first-of-type {
        background-color: var(--bg-light);
    }
    main > section:nth-of-type(2) {
        background-color: var(--bg-white);
    }

    section h2.section-title {
      font-size: 2rem;
      color: var(--text-color-dark);
      margin-bottom: 15px;
      font-weight: 600;
    }
    section p.section-subtitle {
      font-size: 1.1rem;
      color: var(--text-color-light);
      max-width: 700px;
      margin: 0 auto 40px auto;
    }
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
        margin-top: 30px;
        text-align: left;
    }
    .info-item {
        background-color: var(--bg-white);
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.07);
        border-left: 4px solid var(--primary-color);
    }
    .info-item .item-icon {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 15px;
        display: inline-block;
    }
    .info-item h3 {
        color: var(--text-color-dark);
        font-size: 1.3rem;
        margin-top: 0;
        margin-bottom: 10px;
        font-weight: 600;
    }
    .info-item p {
        font-size: 0.95rem;
        color: var(--text-color-light);
        margin-bottom: 0;
    }

    /* --- CSS Configuration for the Custom Vapi Button --- */
    .vapi-button {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 65px;
      height: 65px;
      background-color: #b1976b; /* updated idle colour */
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      z-index: 9999;
      border: none;
      outline: none;
    }

    .vapi-button:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }

    .vapi-button .vapi-icon {
      color: white;
      font-size: 26px;
      transition: opacity 0.2s ease, transform 0.2s ease;
      position: absolute; /* Allows smooth cross-fade */
    }

    /* Idle: hide phone icon */
    .vapi-button .fa-phone-slash {
      opacity: 0;
      transform: scale(0);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    /* Active (call in progress): red button + show phone icon */
    .vapi-button.active {
      background-color: var(--error-color);
    }
    .vapi-button.active .fa-phone-slash {
      opacity: 1;
      transform: scale(1);
    }

    /* UPDATED: CTA VAPI Section for full width band */
    .cta-vapi-section {
      background-color: var(--primary-darker);
      color: white;
      /* border-radius: 8px; /* Removed for sharp corners */
      padding: 50px 0; /* Increased padding, 0 for horizontal to let container handle it */
      margin-top: 0;    /* Removed */
      margin-bottom: 0; /* Removed */
      width: 100%; /* Ensure it spans full width */
    }
    .cta-vapi-section .container { /* Ensure container inside still constrains content */
        max-width: 1024px; /* Or your desired content width */
        margin: 0 auto;
        padding: 0 15px; /* Keep horizontal padding for content */
    }
    .cta-vapi-section h3 {
      font-size: 1.8rem; /* Slightly larger */
      margin-bottom: 15px; /* Adjusted */
      font-weight: 600;
      color: white;
    }
    .cta-vapi-section p {
        color: rgba(255,255,255,0.9);
        margin-bottom: 0;
        font-size: 1.1rem; /* Slightly larger */
    }

    footer.page-footer {
      background-color: var(--text-color-dark);
      color: #bdc3c7;
      padding: 30px 0;
      text-align: center;
      font-size: 0.9rem;
      margin-top: auto; /* This should push footer to bottom if content is short */
                         /* but if cta-vapi-section is last, margin-top: 0 might be fine */
    }
    footer.page-footer p {
        margin: 0 0 10px 0;
        color: #bdc3c7;
    }
    footer.page-footer a {
        color: var(--primary-color);
        text-decoration: none;
    }
    footer.page-footer a:hover {
        text-decoration: underline;
    }
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      z-index: 10000;
      backdrop-filter: blur(3px);
    }
    .modal-overlay .modal-content {
      position: relative;
      background: var(--bg-white);
      padding: 25px 30px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      box-sizing: border-box;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.05);
      text-align: left;
    }
    .modal-overlay .modal-close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      line-height: 1;
      cursor: pointer;
      color: #888;
      transition: color 0.2s ease-in-out;
    }
    .modal-overlay .modal-close-btn:hover { color: #555; }
    .modal-overlay .modal-header-title {
      margin-bottom: 20px;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-color-dark);
    }
    .modal-overlay label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.9rem;
        color: #454545;
    }
    .modal-overlay input[type="text"],
    .modal-overlay input[type="email"],
    .modal-overlay input[type="tel"],
    .modal-overlay input[type="url"] {
      width: 100%;
      margin-bottom: 15px;
      padding: 12px 15px;
      box-sizing: border-box;
      border: 1px solid #dcdcdc;
      border-radius: 6px;
      font-size: 0.95rem;
      transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .modal-overlay input[type="text"]:focus,
    .modal-overlay input[type="email"]:focus,
    .modal-overlay input[type="tel"]:focus,
    .modal-overlay input[type="url"]:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(122, 63, 253, 0.2);
    }
    .modal-overlay input::placeholder { color: #aaa; opacity: 1; }
    .modal-overlay button[type="submit"] {
      width: 100%;
      padding: 12px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, transform 0.1s ease;
      margin-top: 10px;
    }
    .modal-overlay button[type="submit"]:hover { background-color: var(--primary-darker); }
    .modal-overlay button[type="submit"]:active { transform: scale(0.98); }
    .modal-overlay button[type="submit"]:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }
    .modal-message {
        padding: 10px;
        margin-top: 15px;
        border-radius: 5px;
        text-align: center;
        display: none;
    }
    .modal-message.success {
        background-color: #e6ffed;
        color: var(--success-color);
        border: 1px solid var(--success-color);
    }
    .modal-message.error {
        background-color: #ffebee;
        color: var(--error-color);
        border: 1px solid var(--error-color);
    }
    @media (max-width: 992px) {
        .hero-section .main-page-heading { font-size: 2.4rem; }
        .hero-section .main-page-subheading { font-size: 1.15rem; }
    }
    @media (max-width: 768px) {
        header.page-header h1.site-title { font-size: 1.8rem; }
        .hero-section .main-page-heading { font-size: 2rem; }
        .hero-section .main-page-subheading { font-size: 1.1rem; }
        section h2.section-title { font-size: 1.6rem; }
        .container { width: 95%; }
        .info-grid { grid-template-columns: 1fr; }
    }
    /* ----------------- NEW: VAPI button label & loading styles ----------------- */
    .vapi-button.loading {
      pointer-events: none; /* disable clicks while loading */
      opacity: 0.6;         /* visual feedback */
    }

    .vapi-btn-label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #002147; /* updated text colour */
      font-size: 0.65rem;
      font-weight: 600;
      white-space: nowrap;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>

  <header class="page-header">
    <div class="container">
      <div class="logo-container">
          <span class="logo-icon">🐾</span>
          <h1 class="site-title">BAGIRA AI</h1>
      </div>
      <p class="tagline">Интеллектуальная автоматизация для современных юридических фирм</p>
    </div>
  </header>

  <section class="hero-section">
      <div class="container">
          <h1 class="main-page-heading">Bagira AI: революция в привлечении клиентов для вашей юридической фирмы</h1>
          <p class="main-page-subheading">Наш интеллектуальный ассистент круглосуточно обрабатывает запросы, квалифицирует потенциальных клиентов и назначает консультации, освобождая ваше время для юридической практики.</p>
          <button id="joinPilotBtnHero" class="btn btn-primary" style="background-color: #FFD240; color: var(--primary-darker);">Присоединиться к пилотной программе</button>
          
          <div class="video-responsive-wrapper">
              <iframe 
                  src="https://www.youtube.com/embed/U-Ko2DSn3q4?autoplay=0&rel=0" 
                  title="Видео о Bagira AI" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                  allowfullscreen>
              </iframe>
          </div>
      </div>
  </section>

  <main>
    <section class="problems-section">
        <div class="container">
            <h2 class="section-title">Решите проблемы привлечения клиентов в вашей фирме</h2>
            <p class="section-subtitle">Традиционные методы привлечения клиентов устарели. Bagira AI решает ключевые болевые точки.</p>
            <div class="info-grid">
                <div class="info-item">
                    <span class="item-icon"><i class="fas fa-user-clock"></i></span>
                    <h3>Задержки с ответом ведут к потере клиентов</h3>
                    <p>Потенциальные клиенты ожидают немедленного взаимодействия. Задержки означают, что они уходят к вашим конкурентам.</p>
                </div>
                <div class="info-item">
                    <span class="item-icon"><i class="fas fa-microphone-slash"></i></span>
                    <h3>Безличный первый контакт не конвертирует</h3>
                    <p>Голосовая почта и стандартные колл-центры лишены юридического контекста и не могут эффективно выстроить доверие или квалифицировать лидов.</p>
                </div>
                <div class="info-item">
                    <span class="item-icon"><i class="fas fa-folder-minus"></i></span>
                    <h3>Неэффективные процессы истощают ресурсы</h3>
                    <p>Ручная проверка лидов и планирование встреч отнимают ценное время, которое можно было бы потратить на юридическую работу.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="features-section">
        <div class="container">
            <h2 class="section-title">Расширьте возможности вашей фирмы с Bagira AI</h2>
            <p class="section-subtitle">Оптимизируйте процесс привлечения клиентов, улучшите скорость ответа и освободите вашу команду для оплачиваемой работы.</p>
            <div class="info-grid">
                <div class="info-item">
                    <span class="item-icon"><i class="fas fa-comments"></i></span>
                    <h3>Мгновенная квалификация лидов</h3>
                    <p>Привлекайте посетителей сайта немедленно, задавайте квалифицирующие вопросы и выявляйте высокопотенциальных лидов 24/7.</p>
                </div>
                <div class="info-item">
                    <span class="item-icon"><i class="fas fa-calendar-check"></i></span>
                    <h3>Автоматическая запись на консультацию</h3>
                    <p>Беспрепятственно записывайте квалифицированных лидов на первичные консультации прямо в календарь вашей фирмы согласно вашей доступности.</p>
                </div>
                <div class="info-item">
                    <span class="item-icon"><i class="fas fa-clock"></i></span>
                    <h3>Никогда не упускайте возможность</h3>
                    <p>Собирайте лидов и оказывайте первичную поддержку даже в нерабочее время, гарантируя, что ни один потенциальный клиент не будет проигнорирован.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- UPDATED: This section is now styled to be a full-width band -->
    <section class="cta-vapi-section">
      <div class="container"> <!-- Container still centers the content -->
        <h3>Попробуйте Bagira AI в действии</h3>
        <p>
          Узнайте, как Bagira AI взаимодействует с потенциальными клиентами. Нажмите на иконку микрофона и запишитесь на консультацию.
        </p>
      </div>
    </section>
  </main>

  <button id="vapi-button" class="vapi-button" aria-label="Start Voice Assistant">
    <span class="vapi-btn-label">EMZE AI</span>
    <i class="fas fa-phone-slash vapi-icon"></i>
  </button>

  <footer class="page-footer">
    <div class="container">
      <p>© <span id="currentYear"></span> Bagira AI. Все права защищены.</p>
      <!-- The year will be inserted here by JS -->
    </div>
  </footer>

  <!-- MODAL 1: VAPI Client Booking Confirmation -->
  <div id="bagiraFormModal" class="modal-overlay">
    <div class="modal-content">
      <button id="closeBagiraModal" class="modal-close-btn" aria-label="Закрыть">×</button>
      <div id="bagiraModalHeader" class="modal-header-title">
        Пожалуйста, укажите ваши данные для подтверждения записи.
      </div>
      <form id="bagiraForm">
        <input type="hidden" id="callIdInput" name="callId" />
        <label for="nameInput">Имя:</label>
        <input type="text" id="nameInput" name="name" required placeholder="Ваше имя">
        <label for="phoneInput">Номер телефона:</label>
        <input type="tel" id="phoneInput" name="phone" required placeholder="+7 (XXX) XXX-XX-XX">

        <label for="emailInput">Электронная почта:</label>
        <input type="email" id="emailInput" name="email" required placeholder="you@example.com">
        
        <button type="submit">Отправить данные</button>
      </form>
    </div>
  </div>

  <!-- MODAL 2: Pilot Program Signup -->
  <div id="pilotFormModal" class="modal-overlay">
    <div class="modal-content">
        <button id="closePilotModal" class="modal-close-btn" aria-label="Закрыть">×</button>
        <div class="modal-header-title">Присоединиться к пилотной программе Bagira AI</div>
        <form id="pilotProgramForm">
            <label for="pilotName">Ваше имя:</label>
            <input type="text" id="pilotName" name="name" required placeholder="например, Иван Иванов">

            <label for="pilotCompanyName">Название компании:</label>
            <input type="text" id="pilotCompanyName" name="companyName" required placeholder="например, ООО «Юридические Решения»">

            <label for="pilotWebsite">Сайт компании:</label>
            <input type="url" id="pilotWebsite" name="website" required placeholder="https://www.examplelaw.ru">

            <button type="submit" id="submitPilotForm">Отправить заявку</button>
        </form>
        <div id="pilotFormMessage" class="modal-message"></div>
    </div>
  </div>

  <!-- VAPI + n8n integration snippet -->
  <script type="module">
    import Vapi from "https://esm.sh/@vapi-ai/web";

    /* ---------- constants ---------- */
    const API_BASE = "https://primary-production-6b87e.up.railway.app";   // your n8n instance
    const vapi     = new Vapi("58f89212-0e94-4123-8f9e-3bc0dde56fe0");   // ← public key

    /* ---------- DOM helpers ---------- */
    const callBtn        = document.getElementById("vapi-button");
    const form           = document.getElementById("bagiraForm");
    const hiddenInput    = document.getElementById("callIdInput");
    const bagiraModal    = document.getElementById("bagiraFormModal");

    const openPopup  = () => bagiraModal.style.display = "flex";
    const closePopup = () => bagiraModal.style.display = "none";

    /* ---------- Supabase Realtime: listen for call-created broadcast ---------- */
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const sb = createClient(
      'https://wirwojaiknnvtpzaxzjv.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpcndvamFpa25udnRwemF4emp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5NjE3ODcsImV4cCI6MjA2NjUzNzc4N30.XyhklppW2bvJQ7qFv4SWaDaGK_M_YoGFAiOIFo2tW1c'
    );

    sb.channel('bagheera:new-call')
      .on('broadcast', { event: 'call-created' }, ({ payload }) => {
        console.log('🔔 new callId', payload.callId);
        hiddenInput.value = payload.callId;
      })
      .subscribe(status => {
        if (status === 'SUBSCRIBED') {
          console.log('✅ listening for callId broadcasts');
        }
      });

    /* ---------- start or stop call depending on state ---------- */
    const label = callBtn.querySelector('.vapi-btn-label');

    callBtn.onclick = () => {
      if (callBtn.classList.contains("loading")) return; // prevent double-clicks while loading

      // If a call is active, stop it
      if (callBtn.classList.contains("active")) {
        vapi.stop();
        callBtn.classList.add("loading"); // show brief loading until call-end event
        return;
      }

      // Otherwise, start a new call
      callBtn.classList.add("loading");

      vapi
        .start(undefined, undefined, "541e48cf-1f4a-423b-875f-889c6917a56d")
        .catch((err) => {
          console.error("Error starting call:", err);
          callBtn.classList.remove("loading");
        });
    };

    /* ---- Event listeners to update UI state ---- */
    vapi.on("call-start", () => {
      callBtn.classList.remove("loading");
      callBtn.classList.add("active");
      if (label) label.style.display = "none";
    });

    vapi.on("call-end", () => {
      callBtn.classList.remove("loading", "active");
      if (label) {
        label.textContent = "EMZE AI";
        label.style.display = "inline";
      }
    });

    // On error before call starts / during call
    vapi.on("error", () => {
      callBtn.classList.remove("loading", "active");
      if (label) {
        label.textContent = "EMZE AI";
        label.style.display = "inline";
      }
    });

    /* ---------- trigger pop-up on assistant phrase ---------- */
    const TRIGGER_PHRASE = "please type your phone number below to confirm.";

    vapi.on("message", async (msg) => {
      if (
        msg.type === "transcript" &&
        msg.role === "assistant" &&
        msg.transcriptType === "final" &&
        typeof msg.transcript === "string" &&
        msg.transcript.toLowerCase().includes(TRIGGER_PHRASE)
      ) {
        openPopup();
      }
    });

    /* ---------- send phone/email + callId to n8n ---------- */
    form.onsubmit = async (e) => {
      e.preventDefault();
      const formData = new FormData(form); // includes phone, email, callId

      try {
        await fetch(
          "https://backendemze.dayeler.com/webhook/toolCall",
          {
            method: "POST",
            body: formData
          }
        );
        alert("Спасибо! Данные отправлены.");
        closePopup();
        form.reset();
      } catch (err) {
        console.error("bagiraForm submit error", err);
        alert("Ошибка отправки. Попробуйте ещё раз.");
      }
    };

    // --- Footer and Pilot Program Modal Logic ---
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    const pilotModal = document.getElementById("pilotFormModal");
    const joinPilotBtn = document.getElementById("joinPilotBtnHero");
    const closePilotModalBtn = document.getElementById("closePilotModal");
    const pilotProgramForm = document.getElementById("pilotProgramForm");
    const pilotFormMessage = document.getElementById("pilotFormMessage");
    const submitPilotFormBtn = document.getElementById("submitPilotForm");

    if (joinPilotBtn) {
        joinPilotBtn.addEventListener("click", () => {
            if (pilotModal) {
                pilotModal.style.display = "flex";
                if (pilotFormMessage) pilotFormMessage.style.display = "none";
                if (pilotProgramForm) pilotProgramForm.reset();
            }
        });
    }

    if (closePilotModalBtn) {
        closePilotModalBtn.addEventListener("click", () => {
            if (pilotModal) pilotModal.style.display = "none";
        });
    }

    window.addEventListener("click", (event) => {
        const bagiraModalElement = document.getElementById("bagiraFormModal");
        const pilotModalElement = document.getElementById("pilotFormModal");

        if (event.target === pilotModalElement) {
            pilotModalElement.style.display = "none";
        }
        if (event.target === bagiraModalElement) {
            bagiraModalElement.style.display = "none";
        }
    });

    if (pilotProgramForm) {
        pilotProgramForm.addEventListener("submit", function(e) {
            e.preventDefault();
            if (pilotFormMessage) pilotFormMessage.style.display = "none";
            if (submitPilotFormBtn) {
                submitPilotFormBtn.disabled = true;
                submitPilotFormBtn.textContent = "Отправка...";
            }

            const formData = {
                name: document.getElementById("pilotName").value,
                companyName: document.getElementById("pilotCompanyName").value,
                website: document.getElementById("pilotWebsite").value
            };

            fetch("https://primary-production-3672.up.railway.app/webhook/vapi-pilotform", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (response.ok) {
                    if (pilotFormMessage) {
                        pilotFormMessage.textContent = "Спасибо! Мы скоро с вами свяжемся.";
                        pilotFormMessage.className = "modal-message success";
                    }
                    pilotProgramForm.reset();
                } else {
                    return response.json().catch(() => ({
                        message: response.statusText || "Неизвестная ошибка сервера"
                    })).then(err => { throw err; });
                }
            })
            .catch(error => {
                console.error("Ошибка отправки пилотной формы:", error);
                let errorMessage = "Ошибка отправки. Пожалуйста, попробуйте еще раз.";
                if (error && error.message) {
                    errorMessage = error.message;
                } else if (typeof error === 'string') {
                    errorMessage = error;
                }
                if (pilotFormMessage) {
                    pilotFormMessage.textContent = "Ошибка: " + errorMessage;
                    pilotFormMessage.className = "modal-message error";
                }
            })
            .finally(() => {
                if (submitPilotFormBtn) {
                    submitPilotFormBtn.disabled = false;
                    submitPilotFormBtn.textContent = "Отправить заявку";
                }
                if (pilotFormMessage) pilotFormMessage.style.display = "block";
            });
        });
    }
  </script>

</body>
</html>
